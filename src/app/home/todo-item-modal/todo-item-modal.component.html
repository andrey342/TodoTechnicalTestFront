<todo-modal [isOpen]="isOpen()" [title]="isEditMode ? 'Edit Task' : 'New Task'" (close)="close.emit(false)">
    <div class="space-y-6">
        <!-- Title -->
        <div class="space-y-2">
            @if (isEditMode) {
            <label class="modal-label">
                Title <span class="text-xs font-normal text-slate-400 ml-1">(Read only)</span>
            </label>
            <div class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-slate-500 flex items-center gap-2">
                <span class="material-symbols-outlined text-[20px]">lock</span>
                {{ title() }}
            </div>
            } @else {
            <todo-input label="Title" placeholder="Ex: Redesign Landing Page" icon="title" [value]="title()"
                (valueChange)="title.set($event)" [autofocus]="true"></todo-input>
            }
        </div>

        <!-- Category -->
        <div class="space-y-3">
            <label class="modal-label">Category</label>
            <todo-category-selector [categories]="categories()" [selected]="category()"
                (selectedChange)="category.set($event)" [disabled]="isEditMode"></todo-category-selector>
        </div>

        <!-- Description -->
        <div class="space-y-2">
            <label class="modal-label" for="task-desc">
                Description
            </label>
            <textarea class="form-input input-primary block h-auto min-h-[120px] resize-none" [disabled]="isLocked()"
                [ngModel]="description()" (ngModelChange)="description.set($event)" id="task-desc"
                placeholder="Describe the task details..."></textarea>
            @if (isLocked()) {
            <p class="text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1">
                <span class="material-symbols-outlined text-[14px]">warning</span>
                Description cannot be edited when progress is over 50%.
            </p>
            }
        </div>

        <!-- Advanced Progression (Only Edit Mode) -->
        @if (isEditMode) {
        <div class="space-y-4 pt-4 border-t border-slate-200 dark:border-slate-700">
            <h3 class="modal-section-title">Progress Registration</h3>

            @if (currentProgress() < 100) { <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <todo-date-input label="Date" [value]="dateInput()" [min]="minDateAllowed()"
                    (valueChange)="dateInput.set($event)"></todo-date-input>
                <todo-percent-input label="Increment" placeholder="Ex: 20" [value]="progressInput()"
                    [max]="maxPercentAllowed()" (valueChange)="progressInput.set($event)"></todo-percent-input>
        </div>
        } @else {
        <p
            class="text-xs text-green-600 flex items-center gap-1 mt-1 bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-200 dark:border-green-900/50">
            <span class="material-symbols-outlined text-[16px]">check_circle</span>
            Task completed. No further progress can be registered.
        </p>
        }

        <div class="flex flex-col mb-4">
            <todo-progress-history [progressions]="progressHistory()"></todo-progress-history>
        </div>

        <div class="space-y-2">
            <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider">Total Progress</label>
            <todo-progress-bar [progress]="currentProgress()" [previewInput]="progressInput()"></todo-progress-bar>
        </div>
    </div>
    }
    </div>

    <!-- Footer -->
    <div footer class="w-full flex flex-col sm:flex-row items-center justify-between gap-3">
        @if (isEditMode) {
        <div class="w-full sm:w-auto">
            <todo-button type="danger" text="Delete" icon="delete" [disabled]="isLocked()" (clicked)="deleteItem()"
                [fullWidth]="true"></todo-button>
        </div>
        } @else {
        <div class="hidden sm:block"></div>
        }

        <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
            <todo-button type="ghost" text="Cancel" (clicked)="close.emit(false)" [fullWidth]="true"></todo-button>

            @if (isEditMode) {
            <todo-button type="primary" text="Save Changes" icon="save"
                [disabled]="isLocked() || description() === initialDescription()" (clicked)="saveChanges()"
                [fullWidth]="true"></todo-button>

            <todo-button type="primary" text="Register Progress" icon="trending_up"
                [disabled]="currentProgress() >= 100 || progressInput() <= 0" (clicked)="registerProgressAction()"
                [fullWidth]="true"></todo-button>
            } @else {
            <todo-button type="primary" text="Create Task" icon="add" (clicked)="saveChanges()"
                [fullWidth]="true"></todo-button>
            }
        </div>
    </div>
</todo-modal>