<todo-modal [isOpen]="isOpen()" [title]="isEditMode ? 'Editar Tarea' : 'Nueva Tarea'" (close)="close.emit(false)">
    <div class="space-y-6 min-w-[300px] sm:min-w-[500px]">
        <!-- Titulo -->
        <div class="space-y-2">
            @if (isEditMode) {
            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200">
                Título <span class="text-xs font-normal text-slate-400 ml-1">(Solo lectura)</span>
            </label>
            <div class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-slate-500 flex items-center gap-2">
                <span class="material-symbols-outlined text-[20px]">lock</span>
                {{ title() }}
            </div>
            } @else {
            <todo-input label="Título" placeholder="Ej: Rediseñar Landing Page" icon="title" [value]="title()"
                (valueChange)="title.set($event)" [autofocus]="true"></todo-input>
            }
        </div>

        <!-- Categoría -->
        <div class="space-y-3">
            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200">Categoría</label>
            <todo-category-selector [categories]="categories()" [selected]="category()"
                (selectedChange)="category.set($event)" [disabled]="isEditMode"></todo-category-selector>
        </div>

        <!-- Descripción -->
        <div class="space-y-2">
            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200" for="task-desc">
                Descripción
            </label>
            <textarea
                class="block w-full rounded-xl border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 text-slate-900 dark:text-white placeholder:text-slate-400 focus:border-primary focus:ring-primary focus:bg-white dark:focus:bg-slate-800 px-4 py-3 text-sm shadow-sm transition-all resize-none leading-relaxed disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="isLocked()" [ngModel]="description()" (ngModelChange)="description.set($event)"
                id="task-desc" rows="3" placeholder="Describe los detalles de la tarea..."></textarea>
            @if (isLocked()) {
            <p class="text-xs text-amber-600 dark:text-amber-400 flex items-center gap-1">
                <span class="material-symbols-outlined text-[14px]">warning</span>
                La descripción no se puede editar con más del 50% de progreso.
            </p>
            }
        </div>

        <!-- Progreso (solo en edición) -->
        @if (isEditMode) {
        <todo-range-slider label="% de Progreso" [value]="targetProgress()" (valueChange)="targetProgress.set($event)"
            [disabled]="originalProgress() >= 100" [min]="originalProgress()"></todo-range-slider>

        @if (originalProgress() >= 100) {
        <p class="text-xs text-green-600 flex items-center gap-1 mt-1">
            <span class="material-symbols-outlined text-[16px]">check_circle</span>
            Tarea completada. No se puede registrar más progreso.
        </p>
        }
        }
    </div>

    <!-- Footer -->
    <div footer class="w-full flex flex-col sm:flex-row items-center justify-between gap-3">
        @if (isEditMode) {
        <div class="w-full sm:w-auto">
            <todo-button type="danger" text="Eliminar" icon="delete" [disabled]="isLocked()" (clicked)="deleteItem()"
                [fullWidth]="true"></todo-button>
        </div>
        } @else {
        <div class="hidden sm:block"></div>
        }

        <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
            <todo-button type="ghost" text="Cancelar" (clicked)="close.emit(false)" [fullWidth]="true"></todo-button>

            @if (isEditMode) {
            <todo-button type="primary" text="Guardar Cambios" icon="save"
                [disabled]="isLocked() || description() === initialDescription()" (clicked)="saveChanges()"
                [fullWidth]="true"></todo-button>

            <todo-button type="primary" text="Registrar Progreso" icon="trending_up"
                [disabled]="targetProgress() <= originalProgress()" (clicked)="registerProgressAction()"
                [fullWidth]="true"></todo-button>
            } @else {
            <todo-button type="primary" text="Crear Tarea" icon="add" (clicked)="saveChanges()"
                [fullWidth]="true"></todo-button>
            }
        </div>
    </div>
</todo-modal>